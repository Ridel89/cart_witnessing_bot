# Cart witnessing bot
Це телеграм бот який робить бронювання на служіння зі стендом, на вибраний день та годину, в гугл таблиці.
## Функції
 - записатися
 - скасувати запис
 - переглянути графік
 - змінити ім'я
 - показати інформаційне повідомлення
 - доступ до бота по паролю

## Передумови
Потрібно мати google еккаунт.  
Потрібно встановити наступні інструменти:
 - git https://git-scm.com/downloads
 - node.js https://nodejs.org/uk
 - npm https://www.npmjs.com/
 - visual studio code https://code.visualstudio.com/

## Створюємо телеграм бота
В telegram, заходимо в кореневий батьківський бот:
 https://t.me/BotFather

Викликаємо або вводимо команду
 `/newbot`

 Вводимо ім'я бота, яке буде відображатися в пошуку.  
 Вводимо ім'я користувача для вашого бота англійською мовою яке має закінчуватися на "bot", наприклад TetrisBot or tetris_bot.  

 BotFather надішле вам токен бота, для взаємодії з ним, який ми зберігаємо і впишемо в програмний код в змінну `telegramBotToken`.

створюємо меню бота
`/setcommands`

Вводимо:
```
start - Розпочати роботу з ботом
assign - Записатися на стенд
cancel - Скасувати запис на стенд
schedule - Переглянути графік
change_name - Змінити ім'я
help - Отримати допомогу
```
Задаємо фото профілю бота:
`/setuserpic`

Якщо потрібно то виконуємо наступні команди
```
/setname - змінити назву бота
/setdescription - змінити опис бота
/setabouttext - змінити інформацію про бота
```

## Створюємо документ google таблиці
Документ можна створити в google таблицях або на google диску.  
Відкриваємо документ, в адресному рядку браузера з посилання документа копіюємо id документа
**наприклад** посилання може виглядати так:
https://docs.google.com/spreadsheets/d/{ssId}/edit#gid=0
Де {ssId} і є id документа, зберігаємо і пізніше впишемо в програмний код.
**наприклад**:
`ssId` = {ssId}

Створюємо скрипт в google таблиці документі - `розширення` -> `app script`
Налаштування проекту (шестерня) ->
копіюємо `Ідентифікатор сценарію` `scriptId`.

## Клонуємо код з репозиторію gitHub на комп'ютер
В командному рядку пишемо: git clone https://github.com/Ridel89/cart_witnessing_bot.git або завантажуємо: `<> code` -> `download ZIP`

Відкриваємо cклоновану папочку cart_witnessing_bot в visual studio code
view -> terminal і пишемо в терміналі:
npm install @google/clasp -g
`clasp login`
`clasp clone <scriptId>`
де `<scriptId>` Ідентифікатор сценарію	
`clasp push`

https://developers.google.com/apps-script/guides/clasp

Оновлюємо в браузері сторінку з app script і файли які були в папочці на компютері повинні підтягнутися в app script

Заходимо в visual studio code і находимо файлік globalVariables.js і задаємо раніше збережені id:
`telegramBotToken`
`ssId`
Задаємо пароль для доступу до бота, змінна `password`. Оновлюємо код: `clasp push` і перевіряємо чи змінився код в app script. 

## Деплоїмо app script
 `Ввести в дію` -> `керування введенням в дію` -> `створити версію для введення в дію`
 
`тип` -> `веб додаток` -> `хто має доступ` -> `всі` -> `ввести в дію`
`надати доступ` -> вибираємо еккаунт -> `advanced` -> `go to назва проекта (unsafe)` -> `allow (дозволити)`.
копіюємо URL-адресу веб додатку

У visual studio знаходимо файл globalVariable.js і прописуємо URL-адресу веб додатку в змінну `webAppUrl`.
`clasp push`

В редакторі Apps Script:
`Ввести в дію` -> `керування введенням в дію` -> `іконка олівчика (редагувати)` -> `версія: нова версія` -> `ввести в дію` -> `готово`

## Вказуємо боту посилання на Apps Script
В редакторі Apps Script:
Заходимо в файл telegramAPI.gs, вибираємо функцію `setWebhook`, запустити.

## Генеруємо графік в гугл таблиці
В редакторі Apps Script, заходимо в файл utils.gs, вибираємо функцію `createEmptySchedule`, можемо задати кількість днів, початкову годину і кінцеву годину, а далі запустити.








